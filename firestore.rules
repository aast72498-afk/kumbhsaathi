/**
 * DEVELOPMENT RULESET
 *
 * This ruleset is configured for rapid development and testing. It allows
 * open read and write access to all collections. This is NOT secure for a
 * production environment.
 *
 * The primary goal is to unblock front-end development and testing of the
 * registration and ghat update flows without being hindered by permission
 * errors.
 *
 * TODO before production:
 * - Implement granular security rules.
 * - Enforce data validation on writes.
 * - Restrict read/write access to authenticated and authorized users.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description
     *   Open access for development. Allows reading and writing to the ghats
     *   collection, which is necessary for the registration transaction to update
     *   the crowd count.
     */
    match /ghats/{ghatId} {
      allow read, write: if true;
    }

    /**
     * @description
     *   Open access for development. Allows creating new registration documents.
     *   The original rules were too strict, preventing reads/updates which
     *   can interfere with complex transactions or debugging.
     *
     *   Example Production Validation:
     *   allow create: if isSignedIn() &&
     *                    request.resource.data.mobileNumber.matches("^\\d{10}$") &&
     *                    request.resource.data.id.matches("^KM-27-.*");
     */
    match /registrations/{registrationId} {
      allow read, write: if true;
    }

    // Fallback rule for any other collections created during development
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
