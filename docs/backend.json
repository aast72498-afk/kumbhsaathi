{
  "entities": {
    "PilgrimRegistration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PilgrimRegistration",
      "type": "object",
      "description": "Represents a pilgrim's registration for a specific time slot at a Ghat.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the registration."
        },
        "fullName": {
          "type": "string",
          "description": "Full name of the pilgrim."
        },
        "mobileNumber": {
          "type": "string",
          "description": "Mobile number of the pilgrim (for WhatsApp/Telegram)."
        },
        "numberOfPeople": {
          "type": "number",
          "description": "Number of people in the pilgrim's group."
        },
        "date": {
          "type": "string",
          "description": "Date of the planned visit.",
          "format": "date"
        },
        "ghatId": {
          "type": "string",
          "description": "Reference to the Ghat entity. (Relationship: Ghat 1:N PilgrimRegistration)"
        },
        "timeSlot": {
          "type": "string",
          "description": "The time slot selected for the visit (e.g., 6 AM - 9 AM)."
        },
        "confirmationCode": {
          "type": "string",
          "description": "Unique confirmation code generated for the registration (KM-27-[GhatShortName]-[4RandomChars])."
        },
        "registrationTimestamp": {
          "type": "string",
          "description": "Timestamp of when the registration was recorded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "fullName",
        "mobileNumber",
        "numberOfPeople",
        "date",
        "ghatId",
        "timeSlot",
        "confirmationCode",
        "registrationTimestamp"
      ]
    },
    "Ghat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Ghat",
      "type": "object",
      "description": "Represents a Ghat location with its available time slots and capacity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Ghat."
        },
        "name": {
          "type": "string",
          "description": "Name of the Ghat (e.g., Ram Kund, Tapovan)."
        },
        "shortName": {
          "type": "string",
          "description": "Short name of the Ghat (e.g., RK for Ram Kund)."
        },
        "timeSlots": {
          "type": "array",
          "description": "Array of available time slots for the Ghat.",
          "items": {
            "type": "string"
          }
        },
        "maxCapacity": {
          "type": "number",
          "description": "Maximum capacity for each time slot at the Ghat."
        },
        "currentCapacity": {
          "type": "number",
          "description": "Current number of registered pilgrims for each time slot."
        }
      },
      "required": [
        "id",
        "name",
        "shortName",
        "timeSlots",
        "maxCapacity",
        "currentCapacity"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/registrations/{registrationId}",
        "definition": {
          "entityName": "PilgrimRegistration",
          "schema": {
            "$ref": "#/backend/entities/PilgrimRegistration"
          },
          "description": "Stores pilgrim registration information. Requires `registrationId` as a document ID.",
          "params": [
            {
              "name": "registrationId",
              "description": "The unique ID of the registration document."
            }
          ]
        }
      },
      {
        "path": "/ghats/{ghatId}",
        "definition": {
          "entityName": "Ghat",
          "schema": {
            "$ref": "#/backend/entities/Ghat"
          },
          "description": "Stores information about each Ghat, including its name, time slots, and capacity.",
          "params": [
            {
              "name": "ghatId",
              "description": "The unique ID of the Ghat document."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. The core idea is to separate different types of data into distinct collections with specific security rules, thereby simplifying the rule definitions and preventing unintended data access.\n\n1.  **Pilgrim Registrations:** Pilgrim registration data is stored in a collection named `registrations`. This collection stores each pilgrim's information, including personal details, ghat preference, time slot, and a unique confirmation code. Since there is no user authentication and all registrations can be considered to have the same level of authorization, all registrations are added to one single collection and will require no `get()` calls for security rules.\n\n2.  **Ghat Information:** Ghat details, including time slots and capacities, are stored in the `ghats` collection.  This information is mostly public and used to display the real-time status of each ghat.  Given the application needs no write access for pilgrims, the data has no need for authorization.\n\nThis structure achieves Authorization Independence by avoiding hierarchical dependencies.  All security rules can be implemented without requiring `get()` calls to parent documents, ensuring atomic operations and ease of debugging.  QAPs are supported by segregating data based on access requirements. The structure also enables secure list operations, because there is no parent document required to validate list access."
  }
}